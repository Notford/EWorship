<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorshipFlow PRO - Production Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a1a2e; --secondary: #16213e; --accent: #0f3460;
            --live: #e94560; --preview: #4cc9f0; --program: #4361ee;
            --control: #2d3748; --text: #f8f9fa; --text-secondary: #a0aec0;
            --success: #4ade80; --warning: #fbbf24; --danger: #ef4444;
            --shadow: 0 4px 6px rgba(0,0,0,0.3); --radius: 8px;
            --transition: all 0.2s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: var(--primary); color: var(--text); overflow: hidden; }
        .monospace { font-family: 'Roboto Mono', monospace; }
        
        /* Layout */
        .production-container {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
            gap: 10px;
            padding: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background: var(--secondary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent);
            box-shadow: var(--shadow);
        }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo i { color: var(--live); font-size: 1.8rem; }
        .logo h1 { font-size: 1.5rem; font-weight: 700; }
        .logo .pro-badge { background: var(--live); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; margin-left: 5px; }
        
        .status-bar { display: flex; gap: 20px; }
        .status-item { display: flex; align-items: center; gap: 8px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .status-dot.live { background: var(--live); animation: pulse 2s infinite; }
        .status-dot.recording { background: var(--danger); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Camera & Input Sources Panel */
        .sources-panel {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }
        .panel-title { font-size: 1rem; font-weight: 600; margin-bottom: 10px; color: var(--text-secondary); }
        
        .camera-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .camera-source {
            background: var(--control);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
        }
        .camera-source.active { border-color: var(--preview); }
        .camera-source.live { border-color: var(--program); }
        .camera-preview {
            height: 100px;
            background: var(--control);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .camera-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .camera-label {
            padding: 8px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Media Sources */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
        }
        .media-source {
            background: var(--control);
            border-radius: var(--radius);
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        .media-source:hover { background: var(--accent); }
        .media-icon { font-size: 1.5rem; margin-bottom: 5px; color: var(--text-secondary); }
        
        /* Preview & Program */
        .video-wall {
            display: grid;
            grid-template-rows: 1fr 200px;
            gap: 10px;
        }
        .preview-program {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .video-monitor {
            background: var(--control);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
        }
        .monitor-header {
            background: var(--secondary);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .monitor-label {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .monitor-content {
            height: calc(100% - 45px);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .monitor-content video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .live-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--live);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 10;
        }
        
        /* Media Player */
        .media-player {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .player-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--control);
            border: none;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        .control-btn:hover { background: var(--accent); transform: scale(1.1); }
        .control-btn.active { background: var(--program); }
        
        /* Switcher Panel */
        .switcher-panel {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .transition-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .transition-btn {
            padding: 10px;
            background: var(--control);
            border: none;
            border-radius: var(--radius);
            color: var(--text);
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
        }
        .transition-btn:hover { background: var(--accent); }
        .transition-btn.active { background: var(--program); }
        
        .take-button {
            background: linear-gradient(45deg, var(--live), #ff2e63);
            color: white;
            border: none;
            padding: 15px;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        .take-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }
        
        /* Audio Mixer */
        .audio-mixer {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
        }
        .mixer-channels {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }
        .channel {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .channel-label {
            width: 80px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .channel-slider {
            flex: 1;
            height: 30px;
            position: relative;
        }
        .slider-track {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            height: 4px;
            background: var(--control);
            border-radius: 2px;
        }
        .slider-fill {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            background: var(--program);
            border-radius: 2px;
            width: 70%;
        }
        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: var(--text);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Streaming Panel */
        .streaming-panel {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
            margin-top: 10px;
        }
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .platform-btn {
            padding: 10px;
            background: var(--control);
            border: none;
            border-radius: var(--radius);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }
        .platform-btn:hover { background: var(--accent); }
        .platform-btn.active { background: var(--program); }
        
        /* Footer */
        .footer {
            grid-column: 1 / -1;
            background: var(--secondary);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid var(--accent);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* Effects & Overlays */
        .effects-panel {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 15px;
            margin-top: 10px;
        }
        .effects-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .effect-btn {
            padding: 8px;
            background: var(--control);
            border: none;
            border-radius: var(--radius);
            color: var(--text);
            cursor: pointer;
            font-size: 0.8rem;
            text-align: center;
            transition: var(--transition);
        }
        .effect-btn:hover { background: var(--accent); }
        
        /* Scripture Display */
        .scripture-display {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .scripture-container {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            width: 90%;
        }
        .scripture-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .scripture-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Webcam Modal */
        .webcam-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .webcam-container {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        .webcam-video {
            width: 100%;
            max-height: 400px;
            background: var(--control);
            border-radius: var(--radius);
            margin: 20px 0;
        }
        
        /* Camera Filters */
        .camera-filter {
            filter: none;
            transition: filter 0.3s ease;
        }
        .filter-none { filter: none; }
        .filter-brightness { filter: brightness(1.5); }
        .filter-contrast { filter: contrast(1.5); }
        .filter-saturation { filter: saturate(2); }
        .filter-sepia { filter: sepia(1); }
        .filter-grayscale { filter: grayscale(1); }
        .filter-blur { filter: blur(2px); }
        .filter-hue { filter: hue-rotate(90deg); }
        .filter-invert { filter: invert(1); }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .production-container {
                grid-template-columns: 250px 1fr 350px;
            }
        }
        @media (max-width: 1200px) {
            .production-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto auto;
            }
            .sources-panel, .switcher-panel {
                grid-column: 1;
            }
            .video-wall {
                grid-row: 3;
            }
        }
    </style>
</head>
<body>
    <div class="production-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-broadcast-tower"></i>
                <h1>WorshipFlow <span class="pro-badge">PRO</span></h1>
                <div class="monospace" style="margin-left: 20px; color: var(--text-secondary);">
                    <i class="fas fa-clock"></i> <span id="currentTime">--:--:--</span>
                </div>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot live"></div>
                    <span>LIVE</span>
                </div>
                <div class="status-item">
                    <div class="status-dot recording"></div>
                    <span>REC</span>
                </div>
                <div class="status-item">
                    <span>CAMERAS: <span id="activeCameras">0</span>/<span id="totalCameras">0</span></span>
                </div>
                <div class="status-item">
                    <span>FPS: <span id="fpsCounter">--</span></span>
                </div>
            </div>
        </div>
        
        <!-- Sources Panel -->
        <div class="sources-panel">
            <div>
                <div class="panel-title">CAMERA SOURCES</div>
                <div class="camera-grid" id="cameraGrid">
                    <!-- Cameras will be dynamically added -->
                </div>
                <div style="margin-top: 10px;">
                    <button class="control-btn" id="addCameraBtn" style="width: 100%; border-radius: var(--radius); padding: 10px;">
                        <i class="fas fa-plus"></i> Add Camera
                    </button>
                </div>
            </div>
            
            <div>
                <div class="panel-title">CAMERA FILTERS</div>
                <div class="effects-grid">
                    <button class="effect-btn" data-filter="none">None</button>
                    <button class="effect-btn" data-filter="brightness">Bright</button>
                    <button class="effect-btn" data-filter="contrast">Contrast</button>
                    <button class="effect-btn" data-filter="saturation">Saturated</button>
                    <button class="effect-btn" data-filter="sepia">Sepia</button>
                    <button class="effect-btn" data-filter="grayscale">B&W</button>
                    <button class="effect-btn" data-filter="blur">Blur</button>
                    <button class="effect-btn" data-filter="hue">Color Shift</button>
                </div>
            </div>
            
            <div>
                <div class="panel-title">MEDIA SOURCES</div>
                <div class="media-grid" id="mediaGrid">
                    <div class="media-source" data-media="scripture">
                        <div class="media-icon">
                            <i class="fas fa-bible"></i>
                        </div>
                        <div style="font-size: 0.8rem;">Scripture</div>
                    </div>
                    <div class="media-source" data-media="lyrics">
                        <div class="media-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <div style="font-size: 0.8rem;">Lyrics</div>
                    </div>
                    <div class="media-source" data-media="announcement">
                        <div class="media-icon">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div style="font-size: 0.8rem;">Announcement</div>
                    </div>
                    <div class="media-source" data-media="countdown">
                        <div class="media-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div style="font-size: 0.8rem;">Countdown</div>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="panel-title">AUDIO INPUTS</div>
                <div class="mixer-channels" id="audioChannels">
                    <!-- Audio channels will be dynamically added -->
                </div>
            </div>
        </div>
        
        <!-- Preview & Program -->
        <div class="video-wall">
            <div class="preview-program">
                <div class="video-monitor">
                    <div class="monitor-header">
                        <div class="monitor-label">PREVIEW</div>
                        <div class="monospace" style="font-size: 0.8rem;">
                            <i class="fas fa-video"></i> <span id="previewSource">None</span>
                        </div>
                    </div>
                    <div class="monitor-content" id="previewMonitor">
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-eye" style="font-size: 3rem; color: var(--preview); margin-bottom: 10px;"></i>
                            <p>Preview Monitor</p>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Select a source to preview</p>
                        </div>
                    </div>
                </div>
                
                <div class="video-monitor">
                    <div class="monitor-header">
                        <div class="monitor-label">PROGRAM</div>
                        <div class="monospace" style="font-size: 0.8rem; color: var(--live);">
                            <i class="fas fa-circle"></i> <span id="programStatus">STANDBY</span>
                        </div>
                    </div>
                    <div class="monitor-content" id="programMonitor">
                        <div class="live-overlay">STANDBY</div>
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-broadcast-tower" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 10px;"></i>
                            <p>Program Output</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Media Player -->
            <div class="media-player">
                <div class="panel-title">MEDIA PLAYER</div>
                <div id="mediaDisplay">
                    <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        <i class="fas fa-photo-video" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No media playing</p>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="control-btn" id="playMedia">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" id="pauseMedia">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button class="control-btn" id="fullscreenMedia">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="control-btn" onclick="showScripture()">
                        <i class="fas fa-bible"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Switcher Panel -->
        <div class="switcher-panel">
            <div>
                <div class="panel-title">SWITCHER CONTROLS</div>
                <div class="transition-controls">
                    <button class="transition-btn active" data-transition="cut">CUT</button>
                    <button class="transition-btn" data-transition="fade">FADE</button>
                    <button class="transition-btn" data-transition="wipe">WIPE</button>
                    <button class="transition-btn" data-transition="zoom">ZOOM</button>
                    <button class="transition-btn" data-transition="slide">SLIDE</button>
                    <button class="transition-btn" data-transition="cube">CUBE</button>
                </div>
                
                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary); font-size: 0.9rem;">
                        Transition Duration: <span id="transitionDuration">1.0</span>s
                    </label>
                    <input type="range" id="transitionSlider" min="0" max="5" step="0.1" value="1" style="width: 100%;">
                </div>
                
                <button class="take-button" id="takeButton">
                    <i class="fas fa-exchange-alt"></i> TAKE TO PROGRAM
                </button>
            </div>
            
            <!-- Audio Mixer -->
            <div class="audio-mixer">
                <div class="panel-title">AUDIO MIXER</div>
                <div id="mixerControls">
                    <!-- Audio mixer controls -->
                </div>
                <div style="margin-top: 15px;">
                    <button class="control-btn" id="testAudio" style="width: 100%; border-radius: var(--radius);">
                        <i class="fas fa-volume-up"></i> Test Audio
                    </button>
                </div>
            </div>
            
            <!-- Streaming Panel -->
            <div class="streaming-panel">
                <div class="panel-title">STREAMING</div>
                <div class="platform-grid">
                    <button class="platform-btn" data-platform="youtube">
                        <i class="fab fa-youtube" style="color: #ff0000;"></i> YouTube
                    </button>
                    <button class="platform-btn" data-platform="facebook">
                        <i class="fab fa-facebook" style="color: #1877f2;"></i> Facebook
                    </button>
                    <button class="platform-btn active" data-platform="webrtc">
                        <i class="fas fa-wifi"></i> WebRTC Test
                    </button>
                    <button class="platform-btn" data-platform="record">
                        <i class="fas fa-record-vinyl"></i> Record
                    </button>
                </div>
                <div style="margin-top: 15px;">
                    <button class="take-button" id="startStream" style="background: var(--live);">
                        <i class="fas fa-broadcast-tower"></i> START STREAM
                    </button>
                    <button class="take-button" id="stopStream" style="background: var(--control); margin-top: 10px; display: none;">
                        <i class="fas fa-stop"></i> STOP STREAM
                    </button>
                </div>
            </div>
            
            <!-- Effects Panel -->
            <div class="effects-panel">
                <div class="panel-title">OVERLAYS</div>
                <div class="effects-grid">
                    <button class="effect-btn" data-effect="lowerthird">Lower Third</button>
                    <button class="effect-btn" data-effect="countdown">Countdown</button>
                    <button class="effect-btn" data-effect="logo">Logo</button>
                    <button class="effect-btn" data-effect="title">Title</button>
                    <button class="effect-btn" data-effect="social">Social Media</button>
                    <button class="effect-btn" data-effect="clock">Clock</button>
                    <button class="effect-btn" data-effect="watermark">Watermark</button>
                    <button class="effect-btn" data-effect="clear">Clear All</button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="monospace">
                <i class="fas fa-microchip"></i> SYSTEM: <span id="systemStatus">INITIALIZING</span>
            </div>
            <div>
                <span>RES: <span id="resolution">--x--</span></span>
                <span style="margin-left: 20px;">BITRATE: <span id="bitrate">--</span> kbps</span>
            </div>
            <div>
                <button class="control-btn" style="width: 30px; height: 30px;" onclick="showWebcamSettings()">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="control-btn" style="width: 30px; height: 30px; margin-left: 10px;" onclick="fullscreenProgram()">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Scripture Display Modal -->
    <div class="scripture-display" id="scriptureModal">
        <div class="scripture-container">
            <div class="scripture-header">
                <h2>Scripture Display</h2>
                <button class="scripture-close" onclick="hideScripture()">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select id="bibleBook" style="flex: 1; padding: 10px; background: var(--control); color: white; border: none; border-radius: var(--radius);">
                        <option>Genesis</option>
                        <option>Exodus</option>
                        <option selected>John</option>
                        <option>Romans</option>
                        <option>Psalms</option>
                    </select>
                    <input type="number" id="bibleChapter" placeholder="Chapter" value="3" style="width: 100px; padding: 10px; background: var(--control); color: white; border: none; border-radius: var(--radius);">
                    <input type="number" id="bibleVerse" placeholder="Verse" value="16" style="width: 100px; padding: 10px; background: var(--control); color: white; border: none; border-radius: var(--radius);">
                </div>
                <button onclick="loadScripture()" style="width: 100%; padding: 12px; background: var(--program); color: white; border: none; border-radius: var(--radius); margin-bottom: 15px; cursor: pointer;">
                    <i class="fas fa-book"></i> Load Scripture
                </button>
            </div>
            <div id="scriptureText" style="font-size: 1.8rem; line-height: 1.6; text-align: center; padding: 30px; background: rgba(255,255,255,0.05); border-radius: var(--radius); min-height: 200px; display: flex; align-items: center; justify-content: center;">
                "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life."
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="sendToPreview('scripture')" style="flex: 1; padding: 12px; background: var(--preview); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button onclick="sendToProgram('scripture')" style="flex: 1; padding: 12px; background: var(--program); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-broadcast-tower"></i> Program
                </button>
                <button onclick="sendFullscreen('scripture')" style="flex: 1; padding: 12px; background: var(--live); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-expand"></i> Fullscreen
                </button>
            </div>
        </div>
    </div>
    
    <!-- Webcam Settings Modal -->
    <div class="webcam-modal" id="webcamModal">
        <div class="webcam-container">
            <div class="scripture-header">
                <h2>Camera Settings</h2>
                <button class="scripture-close" onclick="hideWebcamSettings()">&times;</button>
            </div>
            
            <div id="webcamPreview" class="webcam-video">
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-video-slash" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i>
                    <p>Camera Preview</p>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Camera</label>
                        <select id="cameraSelect" style="width: 100%; padding: 10px; background: var(--control); color: white; border: none; border-radius: var(--radius);">
                            <option>Select Camera</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Resolution</label>
                        <select id="resolutionSelect" style="width: 100%; padding: 10px; background: var(--control); color: white; border: none; border-radius: var(--radius);">
                            <option value="640x480">640x480 (SD)</option>
                            <option value="1280x720" selected>1280x720 (HD)</option>
                            <option value="1920x1080">1920x1080 (Full HD)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <div class="slider-group">
                    <div class="slider-label">
                        <span>Brightness</span>
                        <span id="webcamBrightness">100%</span>
                    </div>
                    <input type="range" id="webcamBrightnessSlider" min="0" max="200" value="100" style="width: 100%;">
                </div>
                
                <div class="slider-group">
                    <div class="slider-label">
                        <span>Contrast</span>
                        <span id="webcamContrast">100%</span>
                    </div>
                    <input type="range" id="webcamContrastSlider" min="0" max="200" value="100" style="width: 100%;">
                </div>
                
                <div class="slider-group">
                    <div class="slider-label">
                        <span>Saturation</span>
                        <span id="webcamSaturation">100%</span>
                    </div>
                    <input type="range" id="webcamSaturationSlider" min="0" max="200" value="100" style="width: 100%;">
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="startWebcam()" style="flex: 1; padding: 12px; background: var(--program); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-play"></i> Start Camera
                </button>
                <button onclick="stopWebcam()" style="flex: 1; padding: 12px; background: var(--control); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-stop"></i> Stop Camera
                </button>
                <button onclick="addAsSource()" style="flex: 1; padding: 12px; background: var(--success); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                    <i class="fas fa-plus"></i> Add as Source
                </button>
            </div>
        </div>
    </div>

    <script>
        // Production State
        const productionState = {
            cameras: [],
            streams: {},
            activeFilter: 'none',
            previewSource: null,
            programSource: null,
            transition: 'cut',
            transitionDuration: 1.0,
            isStreaming: false,
            isRecording: false,
            audioContext: null,
            audioStream: null,
            mediaRecorder: null,
            currentMedia: null,
            overlays: []
        };

        // Initialize Production
        async function initializeProduction() {
            updateTime();
            setupEventListeners();
            generateAudioMixer();
            updateStatus();
            
            // Detect available cameras
            await detectCameras();
            
            // Start system monitoring
            startSystemMonitoring();
            
            // Request microphone access for audio
            await initializeAudio();
            
            logActivity('Production system initialized');
        }

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString([], { hour12: false });
            setTimeout(updateTime, 1000);
        }

        // Detect available cameras
        async function detectCameras() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                // Update camera select in modal
                const cameraSelect = document.getElementById('cameraSelect');
                cameraSelect.innerHTML = '<option>Select Camera</option>';
                
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.text = device.label || `Camera ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                document.getElementById('totalCameras').textContent = videoDevices.length;
                logActivity(`Detected ${videoDevices.length} camera(s)`);
                
                return videoDevices;
            } catch (error) {
                console.error('Error detecting cameras:', error);
                logActivity('Camera detection failed', 'error');
                return [];
            }
        }

        // Initialize audio
        async function initializeAudio() {
            try {
                // Request microphone access
                productionState.audioStream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });
                
                // Create audio context for processing
                productionState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = productionState.audioContext.createMediaStreamSource(productionState.audioStream);
                
                logActivity('Audio system initialized');
            } catch (error) {
                console.error('Error initializing audio:', error);
                logActivity('Audio initialization failed - some features disabled', 'warning');
            }
        }

        // Start webcam
        async function startWebcam() {
            const cameraSelect = document.getElementById('cameraSelect');
            const resolutionSelect = document.getElementById('resolutionSelect');
            
            if (cameraSelect.value === 'Select Camera') {
                alert('Please select a camera first');
                return;
            }
            
            try {
                const constraints = {
                    video: {
                        deviceId: { exact: cameraSelect.value },
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                // Parse resolution
                const res = resolutionSelect.value.split('x');
                if (res.length === 2) {
                    constraints.video.width = { ideal: parseInt(res[0]) };
                    constraints.video.height = { ideal: parseInt(res[1]) };
                }
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Display in preview
                const preview = document.getElementById('webcamPreview');
                preview.innerHTML = '';
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.muted = true;
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'cover';
                preview.appendChild(video);
                
                // Store stream
                productionState.tempStream = stream;
                
                logActivity('Camera started successfully');
                
            } catch (error) {
                console.error('Error starting camera:', error);
                alert(`Error starting camera: ${error.message}`);
                logActivity('Failed to start camera', 'error');
            }
        }

        // Stop webcam
        function stopWebcam() {
            if (productionState.tempStream) {
                productionState.tempStream.getTracks().forEach(track => track.stop());
                productionState.tempStream = null;
                
                const preview = document.getElementById('webcamPreview');
                preview.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-video-slash" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i>
                        <p>Camera Preview</p>
                    </div>
                `;
                
                logActivity('Camera stopped');
            }
        }

        // Add camera as source
        function addAsSource() {
            if (!productionState.tempStream) {
                alert('Please start a camera first');
                return;
            }
            
            const cameraSelect = document.getElementById('cameraSelect');
            const cameraName = cameraSelect.options[cameraSelect.selectedIndex].text;
            
            // Create new camera source
            const cameraId = `camera${productionState.cameras.length + 1}`;
            const camera = {
                id: cameraId,
                name: cameraName,
                stream: productionState.tempStream,
                active: true,
                filter: 'none',
                settings: {
                    brightness: 100,
                    contrast: 100,
                    saturation: 100
                }
            };
            
            productionState.cameras.push(camera);
            productionState.streams[cameraId] = productionState.tempStream;
            
            // Generate camera grid
            generateCameraGrid();
            
            // Select this camera
            selectSource(cameraId);
            
            logActivity(`Added ${cameraName} as camera source`);
            
            // Close modal
            hideWebcamSettings();
        }

        // Generate camera grid
        function generateCameraGrid() {
            const cameraGrid = document.getElementById('cameraGrid');
            cameraGrid.innerHTML = '';
            
            productionState.cameras.forEach(camera => {
                const cameraDiv = document.createElement('div');
                cameraDiv.className = `camera-source ${camera.id === productionState.previewSource ? 'active' : ''} ${camera.id === productionState.programSource ? 'live' : ''}`;
                cameraDiv.dataset.cameraId = camera.id;
                cameraDiv.innerHTML = `
                    <div class="camera-preview" id="preview-${camera.id}">
                        <video autoplay muted playsinline></video>
                    </div>
                    <div class="camera-label">
                        <span>${camera.name}</span>
                        <i class="fas fa-circle" style="color: ${camera.active ? 'var(--success)' : 'var(--danger)'}; font-size: 0.6rem;"></i>
                    </div>
                `;
                
                // Set up video stream
                const video = cameraDiv.querySelector('video');
                video.srcObject = camera.stream;
                
                // Apply current filter
                video.className = `camera-filter filter-${camera.filter}`;
                
                cameraDiv.addEventListener('click', () => selectSource(camera.id));
                cameraGrid.appendChild(cameraDiv);
            });
            
            document.getElementById('activeCameras').textContent = productionState.cameras.length;
            document.getElementById('totalCameras').textContent = productionState.cameras.length;
        }

        // Select source
        function selectSource(sourceId) {
            const camera = productionState.cameras.find(c => c.id === sourceId);
            if (!camera) return;
            
            productionState.previewSource = sourceId;
            document.getElementById('previewSource').textContent = camera.name;
            
            // Update camera grid highlights
            document.querySelectorAll('.camera-source').forEach(cam => {
                cam.classList.remove('active');
                if (cam.dataset.cameraId === sourceId) {
                    cam.classList.add('active');
                }
            });
            
            // Update preview monitor
            updatePreviewMonitor();
        }

        // Update preview monitor
        function updatePreviewMonitor() {
            const previewMonitor = document.getElementById('previewMonitor');
            const sourceId = productionState.previewSource;
            
            if (!sourceId) {
                previewMonitor.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-eye" style="font-size: 3rem; color: var(--preview); margin-bottom: 10px;"></i>
                        <p>Preview Monitor</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Select a source to preview</p>
                    </div>
                `;
                return;
            }
            
            const camera = productionState.cameras.find(c => c.id === sourceId);
            if (!camera) return;
            
            previewMonitor.innerHTML = '';
            const video = document.createElement('video');
            video.srcObject = camera.stream;
            video.autoplay = true;
            video.muted = true;
            video.style.width = '100%';
            video.style.height = '100%';
            video.style.objectFit = 'cover';
            video.className = `camera-filter filter-${camera.filter}`;
            previewMonitor.appendChild(video);
        }

        // Update program monitor
        function updateProgramMonitor() {
            const programMonitor = document.getElementById('programMonitor');
            const sourceId = productionState.programSource;
            
            if (!sourceId) {
                programMonitor.innerHTML = `
                    <div class="live-overlay">STANDBY</div>
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-broadcast-tower" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 10px;"></i>
                        <p>Program Output</p>
                    </div>
                `;
                return;
            }
            
            const camera = productionState.cameras.find(c => c.id === sourceId);
            if (!camera) return;
            
            programMonitor.innerHTML = '';
            const video = document.createElement('video');
            video.srcObject = camera.stream;
            video.autoplay = true;
            video.muted = true;
            video.style.width = '100%';
            video.style.height = '100%';
            video.style.objectFit = 'cover';
            video.className = `camera-filter filter-${camera.filter}`;
            
            // Add overlays
            productionState.overlays.forEach(overlay => {
                const overlayDiv = document.createElement('div');
                overlayDiv.style.cssText = overlay.style;
                overlayDiv.innerHTML = overlay.content;
                programMonitor.appendChild(overlayDiv);
            });
            
            // Add live overlay if streaming
            if (productionState.isStreaming) {
                const liveOverlay = document.createElement('div');
                liveOverlay.className = 'live-overlay';
                liveOverlay.textContent = 'LIVE';
                programMonitor.appendChild(liveOverlay);
                document.getElementById('programStatus').textContent = 'LIVE';
            } else {
                document.getElementById('programStatus').textContent = 'PROGRAM';
            }
            
            programMonitor.appendChild(video);
        }

        // Take transition
        function takeTransition() {
            if (!productionState.previewSource) {
                alert('Please select a preview source first');
                return;
            }
            
            const preview = productionState.previewSource;
            const program = productionState.programSource;
            
            if (preview !== program) {
                productionState.programSource = preview;
                
                // Update program monitor
                updateProgramMonitor();
                
                // Update camera grid highlights
                document.querySelectorAll('.camera-source').forEach(cam => {
                    cam.classList.remove('live');
                    if (cam.dataset.cameraId === preview) {
                        cam.classList.add('live');
                    }
                });
                
                // Show transition effect
                showTransitionEffect();
                
                // Log the transition
                logActivity(`Transition: ${program || 'None'}  ${preview} (${productionState.transition})`);
            }
        }

        // Show transition effect
        function showTransitionEffect() {
            const programMonitor = document.getElementById('programMonitor');
            const effect = productionState.transition;
            
            // Add transition class
            programMonitor.classList.add(`transition-${effect}`);
            
            // Remove after duration
            setTimeout(() => {
                programMonitor.classList.remove(`transition-${effect}`);
            }, productionState.transitionDuration * 1000);
        }

        // Generate audio mixer
        function generateAudioMixer() {
            const mixerControls = document.getElementById('mixerControls');
            mixerControls.innerHTML = '';
            
            const channels = [
                { id: 'master', name: 'Master', level: 0.8, mute: false },
                { id: 'mic', name: 'Microphone', level: 0.7, mute: false },
                { id: 'music', name: 'Music', level: 0.6, mute: false },
                { id: 'system', name: 'System', level: 0.5, mute: false }
            ];
            
            channels.forEach(channel => {
                const channelDiv = document.createElement('div');
                channelDiv.className = 'channel';
                channelDiv.innerHTML = `
                    <div class="channel-label">${channel.name}</div>
                    <div class="channel-slider">
                        <div class="slider-track"></div>
                        <div class="slider-fill" style="width: ${channel.level * 100}%"></div>
                        <div class="slider-handle" style="left: ${channel.level * 100}%"></div>
                    </div>
                    <button class="control-btn" style="width: 30px; height: 30px;" data-channel="${channel.id}">
                        <i class="fas ${channel.mute ? 'fa-volume-mute' : 'fa-volume-up'}"></i>
                    </button>
                `;
                mixerControls.appendChild(channelDiv);
                
                // Add slider interaction
                const slider = channelDiv.querySelector('.slider-handle');
                const sliderTrack = channelDiv.querySelector('.slider-track');
                let isDragging = false;
                
                const updateSlider = (clientX) => {
                    const rect = sliderTrack.getBoundingClientRect();
                    let percentage = (clientX - rect.left) / rect.width;
                    percentage = Math.max(0, Math.min(1, percentage));
                    
                    channel.level = percentage;
                    channelDiv.querySelector('.slider-fill').style.width = `${percentage * 100}%`;
                    slider.style.left = `${percentage * 100}%`;
                };
                
                slider.addEventListener('mousedown', () => isDragging = true);
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) updateSlider(e.clientX);
                });
                document.addEventListener('mouseup', () => isDragging = false);
                
                // Mute button
                channelDiv.querySelector('button').addEventListener('click', () => {
                    channel.mute = !channel.mute;
                    const icon = channelDiv.querySelector('i');
                    icon.className = channel.mute ? 'fas fa-volume-mute' : 'fas fa-volume-up';
                    logActivity(`${channel.name} ${channel.mute ? 'muted' : 'unmuted'}`);
                });
            });
        }

        // Start/Stop streaming
        async function toggleStreaming() {
            if (!productionState.isStreaming) {
                // Start streaming
                try {
                    const programSource = productionState.programSource;
                    if (!programSource) {
                        alert('Please select a program source first');
                        return;
                    }
                    
                    const camera = productionState.cameras.find(c => c.id === programSource);
                    if (!camera) return;
                    
                    // Combine video and audio streams
                    const audioStream = productionState.audioStream;
                    const videoStream = camera.stream;
                    
                    if (audioStream && videoStream) {
                        const combinedStream = new MediaStream([
                            ...videoStream.getVideoTracks(),
                            ...audioStream.getAudioTracks()
                        ]);
                        
                        // For WebRTC testing, we'll create a simple peer connection
                        productionState.peerConnection = new RTCPeerConnection();
                        combinedStream.getTracks().forEach(track => {
                            productionState.peerConnection.addTrack(track, combinedStream);
                        });
                        
                        productionState.isStreaming = true;
                        document.getElementById('startStream').style.display = 'none';
                        document.getElementById('stopStream').style.display = 'block';
                        
                        // Update program monitor
                        updateProgramMonitor();
                        
                        logActivity('Streaming started (WebRTC test mode)');
                        
                        // Simulate streaming stats
                        simulateStreamStats();
                    }
                } catch (error) {
                    console.error('Error starting stream:', error);
                    logActivity('Failed to start stream', 'error');
                }
            } else {
                // Stop streaming
                if (productionState.peerConnection) {
                    productionState.peerConnection.close();
                    productionState.peerConnection = null;
                }
                
                productionState.isStreaming = false;
                document.getElementById('startStream').style.display = 'block';
                document.getElementById('stopStream').style.display = 'none';
                
                updateProgramMonitor();
                logActivity('Streaming stopped');
            }
        }

        // Simulate streaming stats
        function simulateStreamStats() {
            if (productionState.isStreaming) {
                // Update bitrate
                const bitrate = 2500 + Math.floor(Math.random() * 2000);
                document.getElementById('bitrate').textContent = bitrate;
                
                // Update resolution
                const resolutions = ['640x480', '1280x720', '1920x1080'];
                const randomRes = resolutions[Math.floor(Math.random() * resolutions.length)];
                document.getElementById('resolution').textContent = randomRes;
                
                // Update FPS
                const fps = 55 + Math.floor(Math.random() * 10);
                document.getElementById('fpsCounter').textContent = fps;
                
                setTimeout(simulateStreamStats, 2000);
            }
        }

        // System monitoring
        function startSystemMonitoring() {
            setInterval(() => {
                // Update CPU usage (simulated)
                const cpu = 20 + Math.floor(Math.random() * 30);
                
                // Update system status
                const status = cpu > 70 ? 'HIGH LOAD' : 'OK';
                document.getElementById('systemStatus').textContent = status;
                document.getElementById('systemStatus').style.color = 
                    cpu > 70 ? 'var(--warning)' : 'var(--success)';
            }, 3000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Transition buttons
            document.querySelectorAll('.transition-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.transition-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    productionState.transition = this.dataset.transition;
                    logActivity(`Transition set to: ${this.dataset.transition}`);
                });
            });
            
            // Transition duration slider
            const durationSlider = document.getElementById('transitionSlider');
            const durationDisplay = document.getElementById('transitionDuration');
            durationSlider.addEventListener('input', function() {
                productionState.transitionDuration = parseFloat(this.value);
                durationDisplay.textContent = this.value;
            });
            
            // Take button
            document.getElementById('takeButton').addEventListener('click', takeTransition);
            
            // Add camera button
            document.getElementById('addCameraBtn').addEventListener('click', showWebcamSettings);
            
            // Filter buttons
            document.querySelectorAll('.effect-btn[data-filter]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    applyFilterToAll(filter);
                    logActivity(`Applied filter: ${filter}`);
                });
            });
            
            // Effect buttons
            document.querySelectorAll('.effect-btn[data-effect]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const effect = this.dataset.effect;
                    if (effect === 'clear') {
                        productionState.overlays = [];
                        updateProgramMonitor();
                        logActivity('Cleared all overlays');
                    } else {
                        applyOverlay(effect);
                    }
                });
            });
            
            // Media source buttons
            document.querySelectorAll('.media-source').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mediaType = this.dataset.media;
                    handleMediaSource(mediaType);
                });
            });
            
            // Streaming controls
            document.getElementById('startStream').addEventListener('click', toggleStreaming);
            document.getElementById('stopStream').addEventListener('click', toggleStreaming);
            
            // Test audio button
            document.getElementById('testAudio').addEventListener('click', () => {
                // Play test tone
                if (productionState.audioContext) {
                    const oscillator = productionState.audioContext.createOscillator();
                    const gainNode = productionState.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(productionState.audioContext.destination);
                    
                    oscillator.frequency.value = 440; // A4 note
                    gainNode.gain.value = 0.1;
                    
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 500);
                    
                    logActivity('Played test tone');
                }
            });
            
            // Webcam settings sliders
            const webcamSliders = ['brightness', 'contrast', 'saturation'];
            webcamSliders.forEach(slider => {
                const sliderEl = document.getElementById(`webcam${slider.charAt(0).toUpperCase() + slider.slice(1)}Slider`);
                const valueEl = document.getElementById(`webcam${slider.charAt(0).toUpperCase() + slider.slice(1)}`);
                
                sliderEl.addEventListener('input', function() {
                    valueEl.textContent = `${this.value}%`;
                    applyWebcamFilter();
                });
            });
        }

        // Apply filter to all cameras
        function applyFilterToAll(filter) {
            productionState.activeFilter = filter;
            
            // Update all camera videos
            document.querySelectorAll('.camera-preview video').forEach(video => {
                video.className = `camera-filter filter-${filter}`;
            });
            
            // Update preview and program if they're cameras
            updatePreviewMonitor();
            updateProgramMonitor();
        }

        // Apply webcam filter in settings
        function applyWebcamFilter() {
            const brightness = document.getElementById('webcamBrightnessSlider').value / 100;
            const contrast = document.getElementById('webcamContrastSlider').value / 100;
            const saturation = document.getElementById('webcamSaturationSlider').value / 100;
            
            const video = document.querySelector('#webcamPreview video');
            if (video) {
                video.style.filter = `brightness(${brightness}) contrast(${contrast}) saturate(${saturation})`;
            }
        }

        // Apply overlay
        function applyOverlay(type) {
            let overlay = null;
            
            switch(type) {
                case 'lowerthird':
                    overlay = {
                        content: `
                            <div style="padding: 15px; background: linear-gradient(90deg, rgba(0,0,0,0.8), rgba(67,97,238,0.8));">
                                <div style="font-size: 1.2rem; font-weight: bold;">Pastor John Smith</div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">Senior Pastor</div>
                            </div>
                        `,
                        style: 'position: absolute; bottom: 20px; left: 20px; right: 20px; color: white; border-radius: var(--radius);'
                    };
                    break;
                case 'countdown':
                    let count = 10;
                    overlay = {
                        content: `<div style="font-size: 4rem; font-weight: bold; text-align: center;">${count}</div>`,
                        style: 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--live);'
                    };
                    
                    // Animate countdown
                    const interval = setInterval(() => {
                        count--;
                        if (count >= 0) {
                            overlay.content = `<div style="font-size: 4rem; font-weight: bold; text-align: center;">${count}</div>`;
                            // Update overlays
                            const index = productionState.overlays.findIndex(o => o === overlay);
                            if (index !== -1) {
                                productionState.overlays[index] = overlay;
                                updateProgramMonitor();
                            }
                        } else {
                            clearInterval(interval);
                            // Remove countdown overlay
                            productionState.overlays = productionState.overlays.filter(o => o !== overlay);
                            updateProgramMonitor();
                        }
                    }, 1000);
                    break;
                case 'logo':
                    overlay = {
                        content: `<i class="fas fa-church" style="font-size: 2rem;"></i>`,
                        style: 'position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 50%; color: white;'
                    };
                    break;
                case 'title':
                    overlay = {
                        content: `<div style="text-align: center; font-size: 1.5rem; font-weight: bold;">Sunday Worship Service</div>`,
                        style: 'position: absolute; top: 20px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: var(--radius); text-align: center;'
                    };
                    break;
                case 'clock':
                    overlay = {
                        content: `<div id="overlayClock">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`,
                        style: 'position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: var(--radius); font-family: monospace; font-size: 1.1rem;'
                    };
                    // Update clock every minute
                    setInterval(() => {
                        const clockDiv = document.getElementById('overlayClock');
                        if (clockDiv) {
                            clockDiv.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        }
                    }, 60000);
                    break;
            }
            
            if (overlay) {
                productionState.overlays.push(overlay);
                updateProgramMonitor();
                logActivity(`Added ${type} overlay`);
            }
        }

        // Handle media source
        function handleMediaSource(type) {
            switch(type) {
                case 'scripture':
                    showScripture();
                    break;
                case 'lyrics':
                    showLyrics();
                    break;
                case 'announcement':
                    showAnnouncement();
                    break;
                case 'countdown':
                    applyOverlay('countdown');
                    break;
            }
        }

        // Scripture display
        function showScripture() {
            document.getElementById('scriptureModal').style.display = 'flex';
        }

        function hideScripture() {
            document.getElementById('scriptureModal').style.display = 'none';
        }

        function loadScripture() {
            const book = document.getElementById('bibleBook').value;
            const chapter = document.getElementById('bibleChapter').value;
            const verse = document.getElementById('bibleVerse').value;
            
            const scriptureText = document.getElementById('scriptureText');
            scriptureText.innerHTML = `
                <div style="margin-bottom: 10px; color: var(--text-secondary); font-size: 1rem;">
                    ${book} ${chapter}:${verse}
                </div>
                "For God so loved the world that he gave his one and only Son, 
                that whoever believes in him shall not perish but have eternal life."
                <div style="margin-top: 20px; font-size: 1rem; color: var(--text-secondary);">
                    - New International Version
                </div>
            `;
            
            logActivity(`Loaded scripture: ${book} ${chapter}:${verse}`);
        }

        function sendToPreview(type) {
            const mediaDisplay = document.getElementById('mediaDisplay');
            if (type === 'scripture') {
                mediaDisplay.innerHTML = document.getElementById('scriptureText').innerHTML;
                logActivity('Scripture sent to preview');
            }
        }

        function sendToProgram(type) {
            if (type === 'scripture') {
                // Create scripture overlay
                const scriptureText = document.getElementById('scriptureText').innerHTML;
                const overlay = {
                    content: `
                        <div style="padding: 30px; text-align: center; background: rgba(0,0,0,0.9); color: white;">
                            ${scriptureText}
                        </div>
                    `,
                    style: 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;'
                };
                
                productionState.overlays.push(overlay);
                updateProgramMonitor();
                logActivity('Scripture sent to program');
                hideScripture();
            }
        }

        function sendFullscreen(type) {
            if (type === 'scripture') {
                const scriptureText = document.getElementById('scriptureText').innerHTML;
                const fullscreenDiv = document.createElement('div');
                fullscreenDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: black;
                    color: white;
                    z-index: 3000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 40px;
                    text-align: center;
                    font-size: 2.5rem;
                    line-height: 1.6;
                `;
                fullscreenDiv.innerHTML = scriptureText;
                
                fullscreenDiv.addEventListener('click', () => fullscreenDiv.remove());
                document.body.appendChild(fullscreenDiv);
                
                logActivity('Scripture sent to fullscreen');
                hideScripture();
            }
        }

        // Lyrics display
        function showLyrics() {
            const lyrics = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="margin-bottom: 20px; color: var(--program);">Amazing Grace</h3>
                    <div style="font-size: 1.5rem; line-height: 1.8;">
                        Amazing grace, how sweet the sound<br>
                        That saved a wretch like me<br>
                        I once was lost, but now am found<br>
                        Was blind, but now I see
                    </div>
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button onclick="sendToProgram('lyrics')" style="padding: 10px 20px; background: var(--program); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                            Send to Program
                        </button>
                        <button onclick="sendFullscreen('lyrics')" style="padding: 10px 20px; background: var(--live); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                            Fullscreen
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('mediaDisplay').innerHTML = lyrics;
            logActivity('Loaded lyrics: Amazing Grace');
        }

        // Announcement display
        function showAnnouncement() {
            const announcement = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="margin-bottom: 20px; color: var(--warning);">Announcements</h3>
                    <div style="font-size: 1.2rem; line-height: 1.6; text-align: left;">
                        <p> Bible Study: Wednesday 7 PM</p>
                        <p> Youth Night: Friday 6 PM</p>
                        <p> Food Drive: This Saturday</p>
                        <p> Prayer Meeting: Daily 6 AM</p>
                    </div>
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button onclick="sendToProgram('announcement')" style="padding: 10px 20px; background: var(--program); color: white; border: none; border-radius: var(--radius); cursor: pointer;">
                            Send to Program
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('mediaDisplay').innerHTML = announcement;
            logActivity('Loaded announcements');
        }

        // Webcam settings
        function showWebcamSettings() {
            document.getElementById('webcamModal').style.display = 'flex';
        }

        function hideWebcamSettings() {
            document.getElementById('webcamModal').style.display = 'none';
        }

        // Fullscreen program
        function fullscreenProgram() {
            const programMonitor = document.getElementById('programMonitor');
            if (!document.fullscreenElement) {
                programMonitor.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Log activity
        function logActivity(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            // In a full implementation, this would add to activity log
            const now = new Date();
            const time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            console.log(`[${time}] ${message}`);
        }

        // Update status
        function updateStatus() {
            // Add CSS for transitions
            const style = document.createElement('style');
            style.textContent = `
                .transition-fade { animation: fadeIn ${productionState.transitionDuration}s; }
                .transition-wipe { 
                    animation: wipe ${productionState.transitionDuration}s;
                    clip-path: inset(0 0 0 0);
                }
                .transition-zoom { animation: zoom ${productionState.transitionDuration}s; }
                .transition-slide { animation: slide ${productionState.transitionDuration}s; }
                .transition-cube { animation: cube ${productionState.transitionDuration}s; }
                
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes wipe { 
                    0% { clip-path: inset(0 100% 0 0); }
                    100% { clip-path: inset(0 0 0 0); }
                }
                @keyframes zoom { 
                    0% { transform: scale(0.8); opacity: 0; }
                    100% { transform: scale(1); opacity: 1; }
                }
                @keyframes slide { 
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(0); }
                }
                @keyframes cube { 
                    0% { transform: rotateY(90deg); opacity: 0; }
                    100% { transform: rotateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeProduction);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Space for take
            if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                e.preventDefault();
                takeTransition();
            }
            // Number keys for cameras
            if (e.code >= 'Digit1' && e.code <= 'Digit4') {
                const cameraIndex = parseInt(e.code[5]) - 1;
                if (cameraIndex < productionState.cameras.length) {
                    selectSource(productionState.cameras[cameraIndex].id);
                }
            }
            // T for transition type
            if (e.code === 'KeyT' && e.ctrlKey) {
                const transitions = document.querySelectorAll('.transition-btn');
                const currentIndex = Array.from(transitions).findIndex(b => b.classList.contains('active'));
                const nextIndex = (currentIndex + 1) % transitions.length;
                transitions[currentIndex].classList.remove('active');
                transitions[nextIndex].classList.add('active');
                productionState.transition = transitions[nextIndex].dataset.transition;
                logActivity(`Transition set to: ${productionState.transition}`);
            }
            // Escape to close modals
            if (e.code === 'Escape') {
                hideScripture();
                hideWebcamSettings();
            }
        });
    </script>
</body>
</html>
